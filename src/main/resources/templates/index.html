<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="UTF-8" />
<link rel="stylesheet" type="text/css" href="/css/style.css" />
<script type="text/javascript" src="/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript">

$(function(){

	//モーダルウィンドウを出現させるクリックイベント
	$("#modal-open").click( function(){

		//キーボード操作などにより、オーバーレイが多重起動するのを防止する
		$( this ).blur() ;	//ボタンからフォーカスを外す
		if( $( "#modal-overlay" )[0] ) return false ;		//新しくモーダルウィンドウを起動しない (防止策1)
		//if($("#modal-overlay")[0]) $("#modal-overlay").remove() ;		//現在のモーダルウィンドウを削除して新しく起動する (防止策2)

		//オーバーレイを出現させる
		$( "body" ).append( '<div id="modal-overlay"></div>' ) ;
		$( "#modal-overlay" ).fadeIn( "slow" ) ;

		//コンテンツをセンタリングする
		centeringModalSyncer() ;

		//コンテンツをフェードインする
		$( "#modal-content" ).fadeIn( "slow" ) ;

		//[#modal-overlay]、または[#modal-close]をクリックしたら…
		$( "#modal-overlay,#modal-close" ).unbind().click( function(){

			//[#modal-content]と[#modal-overlay]をフェードアウトした後に…
			$( "#modal-content,#modal-overlay" ).fadeOut( "slow" , function(){

				//[#modal-overlay]を削除する
				$('#modal-overlay').remove() ;

			} ) ;

		} ) ;

	} ) ;

	//リサイズされたら、センタリングをする関数[centeringModalSyncer()]を実行する
	$( window ).resize( centeringModalSyncer ) ;

		//センタリングを実行する関数
		function centeringModalSyncer() {

			//画面(ウィンドウ)の幅、高さを取得
			var w = $( window ).width() ;
			var h = $( window ).height() ;

			// コンテンツ(#modal-content)の幅、高さを取得
			// jQueryのバージョンによっては、引数[{margin:true}]を指定した時、不具合を起こします。
//			var cw = $( "#modal-content" ).outerWidth( {margin:true} );
//			var ch = $( "#modal-content" ).outerHeight( {margin:true} );
			var cw = $( "#modal-content" ).outerWidth();
			var ch = $( "#modal-content" ).outerHeight();

			//センタリングを実行する
			$( "#modal-content" ).css( {"left": ((w - cw)/2) + "px","top": ((h - ch)/2) + "px"} ) ;

		}

	} ) ;
	
$(function(){

	//モーダルウィンドウを出現させるクリックイベント
	$("#modal-open2").click( function(){

		//キーボード操作などにより、オーバーレイが多重起動するのを防止する
		$( this ).blur() ;	//ボタンからフォーカスを外す
		if( $( "#modal-overlay" )[0] ) return false ;		//新しくモーダルウィンドウを起動しない (防止策1)
		//if($("#modal-overlay")[0]) $("#modal-overlay").remove() ;		//現在のモーダルウィンドウを削除して新しく起動する (防止策2)

		//オーバーレイを出現させる
		$( "body" ).append( '<div id="modal-overlay"></div>' ) ;
		$( "#modal-overlay" ).fadeIn( "slow" ) ;

		//コンテンツをセンタリングする
		centeringModalSyncer() ;

		//コンテンツをフェードインする
		$( "#modal-content2" ).fadeIn( "slow" ) ;

		//[#modal-overlay]、または[#modal-close]をクリックしたら…
		$( "#modal-overlay,#modal-close" ).unbind().click( function(){

			//[#modal-content]と[#modal-overlay]をフェードアウトした後に…
			$( "#modal-content2,#modal-overlay" ).fadeOut( "slow" , function(){

				//[#modal-overlay]を削除する
				$('#modal-overlay').remove() ;

			} ) ;

		} ) ;

	} ) ;

	//リサイズされたら、センタリングをする関数[centeringModalSyncer()]を実行する
	$( window ).resize( centeringModalSyncer ) ;

		//センタリングを実行する関数
		function centeringModalSyncer() {

			//画面(ウィンドウ)の幅、高さを取得
			var w = $( window ).width() ;
			var h = $( window ).height() ;

			// コンテンツ(#modal-content)の幅、高さを取得
			// jQueryのバージョンによっては、引数[{margin:true}]を指定した時、不具合を起こします。
//			var cw = $( "#modal-content2" ).outerWidth( {margin:true} );
//			var ch = $( "#modal-content" ).outerHeight( {margin:true} );
			var cw = $( "#modal-content2" ).outerWidth();
			var ch = $( "#modal-content2" ).outerHeight();

			//センタリングを実行する
			$( "#modal-content2" ).css( {"left": ((w - cw)/2) + "px","top": ((h - ch)/2) + "px"} ) ;

		}

	} ) ;

</script>
<title>アドベントカレンダー</title>
</head>

<body>
	
	<div th:class="title"><!-- class作ってません -->
		<h2>アドベントカレンダー</h2>
	</div>
	
	<div th:class="status"><!-- class作ってません -->
	
		<a href="/loginForm" sec:authorize="isAnonymous()">ログイン</a><br sec:authorize="isAnonymous()" />
		<form th:action="@{/logout}" method="post" sec:authorize="isAuthenticated()"><input type="submit" class="btn btn-default btn-xs" value="ログアウト" /></form>
		<img src="/icon/usericon.jpg" sec:authorize="isAuthenticated()" width="50px" height="50px" />
		<span sec:authentication="principal.user.username" sec:authorize="isAuthenticated()">duke　さん</span><br sec:authorize="isAuthenticated()" />
		<a href = "/users" sec:authorize="hasRole('ROLE_ADMIN')">ユーザー管理</a><br />
		<a href = "/themes" sec:authorize="hasRole('ROLE_ADMIN')">テーマ管理</a>
	
	</div>
	
	<div th:class="theme"><!-- class作ってません -->
	
		⇠　<span th:text="${#dates.format(theme.calendarMonth,'yyyy 年MM 月')}">カレンダーの月</span> ⇢
		<span class="br">今月のテーマは</span><span th:text = "${theme.name}">テーマ</span>
		
	</div>
	
	<div th:class="week">日</div>
	<div th:class="week">月</div>
	<div th:class="week">火</div>
	<div th:class="week">水</div>
	<div th:class="week">木</div>
	<div th:class="week">金</div>
	<div th:class="week">土</div>
	
	<div th:object = "${calendar}" th:each="calendar , stat: ${calendar}" th:class="article">
	
		<!-- trueとfalseが逆判定になってる（謎）classappendの判定がよくわからないので要資料
		modelだと判定は間違えてないです。 -->
		<div class="day">
			<!-- 有効日でかつ土日でなければ黒い日付を表示 -->
			<span th:text="${calendar.day}" th:if="${calendar.isHoliday} == false and ${calendar.isAvalable}">日付</span>
			<!-- 土日でかつ日曜日であれば赤、週の最後は土曜日なので青 -->
			<span th:text="${calendar.day}" th:class="red" th:unless="${stat.count} == 1" th:if = "${calendar.isHoliday}" th:classappend = "${stat.count} % 7 == 0 ? 'blue'">日付</span>
			<!-- 土日でも有効月でなければグレー。（必要な理由：最初の日はisHolidayで判断できていないため） -->
			<span th:text="${calendar.day}" th:class="gray" th:if = "${stat.count} == 1">日付</span>
			<!-- 有効月でなければグレー。 -->
			<span th:text="${calendar.day}" th:class="gray" th:if = "${calendar.isAvalable} == false and ${calendar.isHoliday} == false">日付</span>
		</div>
		<span th:text="登録不可" th:if = "${calendar.isAvalable} and ${calendar.isEnabled} == false and ${calendar.isHoliday} == false">
		登録不可
		</span>
		<span th:text="登録" th:if="${calendar.isEnabled} and ${calendar.isAvalable} and ${calendar.article} == null and ${calendar.isHoliday} == false">登録ボタン</span>
		
		<div th:if="${calendar.isRegistered} and ${calendar.isAvalable}">
			
			<span th:text="${calendar.article.id}">id</span>
			<a th:href="${calendar.article.url}">
			<span th:text="${calendar.article.title}">title</span>
			</a>
		
		</div>
		
	</div>

<!--  これでコードをかっこよくできねえかなリスト
th:if = "${stat.count} % 7 == 0"　（繰り返し回数が7の倍数の要素のときにタグを出す）
classappend = "${stat.count} % 7 == 0 ? 'class'"　（繰り返し回数が7倍数の要素のときクラスを"追加"する）
attr = "要素"=変えたい内容
 -->

<div id="modal-content">
<p><a id="modal-close" class="button-link">閉じる</a></p>
<form method="post" action="">
<h2>記事登録</h2>
登録日付<br />
2017/05/31<br />
<div>
error!
</div>
タイトル：<input type="text" name="title" placeholder="タイトル" required="required" autofocus="autofocus" />
URL：<input type="text" name="url" placeholder="URL" required="required" />
<button class="btn btn-1g btn-primary btn-block" type="submit">投稿</button>
</form>
</div>

<div id="modal-content2">
<p><a id="modal-close" class="button-link">閉じる</a></p>
<form method="post" action="">
<h2>記事更新</h2>
登録日付<br />
2017/05/31<br />
<div>
error!
</div>
タイトル：<input type="text" name="title" placeholder="タイトル" required="required" autofocus="autofocus" />
URL：<input type="text" name="url" placeholder="URL" required="required" />
<button class="btn btn-1g btn-primary btn-block" type="submit">投稿</button>
</form>
</div>
</body>
</html>